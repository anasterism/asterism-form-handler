var Form=function(t){this.el=null,this.action=null,this.method=null,this.button=null,this.errors=null,this.init=function(){this.el=document.querySelector(t),this.action=this.el.getAttribute("action"),this.method=this.el.getAttribute("method"),this.button=document.querySelector(t+" button[type=submit]"),this.button.addEventListener("click",this.submit.bind(this))},this.submit=function(t){t.preventDefault(),this.disable();var e=new FormData(this.el),s=new XMLHttpRequest,i=this;s.open(this.method,this.action),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.addEventListener("load",function(){i.handleResponse(this)}),s.addEventListener("error",function(){i.handleError(this)}),s.send(e)},this.disable=function(){var t=this.el.elements;for(var e in t)t[e].readOnly=!0},this.enable=function(){var t=this.el.elements;for(var e in t)t[e].readOnly=!1},this.reset=function(){this.el.reset()},this.handleResponse=function(t){200==t.status?this.handleSuccess(t):this.handleError(t)},this.handleSuccess=function(t){var e=JSON.parse(t.responseText),s=new CustomEvent("success",{detail:e});this.reset(),this.enable(),this.el.dispatchEvent(s)},this.handleError=function(t){var e=null;if(422==t.status){var s=JSON.parse(t.responseText);this.el.classList.add("hasErrors"),this.processValidationErrors(s),e=new CustomEvent("invalid",{detail:this.errors})}else this.errors="An error was encountered while attempting to process your request.",e=new CustomEvent("error",{detail:this.errors});this.enable(),this.el.dispatchEvent(e)},this.processValidationErrors=function(e){var s=[];for(var i in e){var n={el:document.querySelector(t+" input[name="+i+"]"),field:i,message:e[i][0]};s.push(n)}this.errors=s},this.init()};